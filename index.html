<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoneyMagnet - AI Financial Intelligence</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <span class="nav-logo">ğŸ’°</span>
                <span class="nav-title">MoneyMagnet</span>
            </div>
            <div class="nav-menu">
                <a href="index.html" class="nav-link active">ğŸ“Š Dashboard</a>
                <a href="search.html" class="nav-link">ğŸ” Suche</a>
                <button class="nav-btn" onclick="app.refreshData()">ğŸ”„ Aktualisieren</button>
                <button class="nav-btn" onclick="app.showAPIStatus()" style="margin-left: 0.5rem;">ğŸ“Š Status</button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h1 class="hero-title">
                <span class="gradient-text">AI-Powered</span><br>
                Financial Intelligence
            </h1>
            <p class="hero-subtitle">
                Live Marktdaten, KI-Analysen und Echtzeit-Signale fÃ¼r smarte Investoren
            </p>
            <div class="hero-stats">
                <div class="stat-item">
                    <div class="stat-number" id="totalStocks">500+</div>
                    <div class="stat-label">Aktien</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="totalCrypto">200+</div>
                    <div class="stat-label">Cryptos</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="aiAnalyses">1000+</div>
                    <div class="stat-label">KI-Analysen</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="apiSources">8</div>
                    <div class="stat-label">API-Quellen</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Enhanced Status Bar -->
            <div class="status-bar">
                <div class="status-item">
                    <div class="status-indicator live"></div>
                    <span>Live Daten</span>
                </div>
                <div class="status-item">
                    <div class="status-indicator ai"></div>
                    <span>KI Aktiv</span>
                </div>
                <div class="status-item">
                    <span>APIs: <span id="apiCount">8</span></span>
                </div>
                <div class="status-item">
                    <span>Fallback: <span id="fallbackStatus">Bereit</span></span>
                </div>
                <div class="status-item">
                    <span>Letztes Update: <span id="lastUpdate">--:--</span></span>
                </div>
            </div>

            <!-- Enhanced AI Banner -->
            <div class="ai-banner">
                <div class="ai-icon">ğŸ¤–</div>
                <div class="ai-text">
                    <strong>Enhanced MoneyMagnet v2.0:</strong> Nutzt jetzt 8 APIs (Yahoo Finance, NewsAPI, ExchangeRate-API, Polygon.io) mit intelligentem Fallback-System und realistischen Simulationen bei API-Limits.
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="tab-nav">
                <button class="tab-btn active" data-tab="signals">ğŸ¤– KI-Signale</button>
                <button class="tab-btn" data-tab="news">ğŸ“ˆ News</button>
                <button class="tab-btn" data-tab="market">ğŸ“Š Markt</button>
                <button class="tab-btn" data-tab="ideas">ğŸ’¡ Ideen</button>
            </div>

            <!-- Tab Content -->
            <div class="tab-content">
                <!-- KI Signale Tab -->
                <div id="signals-tab" class="tab-pane active">
                    <div class="card">
                        <div class="card-header">
                            <h2>ğŸ¯ Enhanced Trading-Signale</h2>
                            <div class="signal-stats">
                                <span class="stat-badge">
                                    <span id="bullishCount">0</span> Bullish
                                </span>
                                <span class="stat-badge">
                                    <span id="bearishCount">0</span> Bearish
                                </span>
                            </div>
                        </div>
                        <div class="ai-banner">
                            <div class="ai-icon">ğŸš€</div>
                            <div class="ai-text">
                                <strong>Multi-Source KI-Analyse:</strong> Kombiniert Yahoo Finance Premium-Daten, NewsAPI Nachrichten und FinBERT AI fÃ¼r prÃ¤zise Trading-Signale. Bei API-Limits nutzt intelligente technische Simulation.
                            </div>
                        </div>
                        <div id="signals-container" class="signals-grid">
                            <div class="loading">
                                <div class="spinner"></div>
                                <span>Generiere erweiterte KI-Signale...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- News Tab -->
                <div id="news-tab" class="tab-pane">
                    <div class="card">
                        <div class="card-header">
                            <h2>ğŸ“ˆ Enhanced Finanznachrichten</h2>
                            <div class="signal-stats">
                                <span class="stat-badge" id="newsSource">NewsAPI</span>
                            </div>
                        </div>
                        <div id="news-container" class="news-grid">
                            <div class="loading">
                                <div class="spinner"></div>
                                <span>Lade erweiterte Nachrichten...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Markt Tab -->
                <div id="market-tab" class="tab-pane">
                    <div class="market-grid">
                        <div class="card">
                            <div class="card-header">
                                <h2>ğŸ“ˆ Top Gewinner</h2>
                                <div class="signal-stats">
                                    <span class="stat-badge" id="winnersSource">Multi-Source</span>
                                </div>
                            </div>
                            <div id="winners-container">
                                <div class="loading">
                                    <div class="spinner"></div>
                                    <span>Lade erweiterte Daten...</span>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h2>ğŸ“‰ Top Verlierer</h2>
                                <div class="signal-stats">
                                    <span class="stat-badge" id="losersSource">Multi-Source</span>
                                </div>
                            </div>
                            <div id="losers-container">
                                <div class="loading">
                                    <div class="spinner"></div>
                                    <span>Lade erweiterte Daten...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h2>â‚¿ Enhanced Krypto News</h2>
                            <div class="signal-stats">
                                <span class="stat-badge" id="cryptoNewsSource">NewsAPI</span>
                            </div>
                        </div>
                        <div id="crypto-news-container" class="news-grid">
                            <div class="loading">
                                <div class="spinner"></div>
                                <span>Lade erweiterte Krypto-News...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ideen Tab -->
                <div id="ideas-tab" class="tab-pane">
                    <div class="card">
                        <div class="card-header">
                            <h2>ğŸ’¡ Enhanced Trading-Ideen</h2>
                            <div class="signal-stats">
                                <span class="stat-badge" id="ideasSource">Multi-API</span>
                            </div>
                        </div>
                        <div class="ai-banner">
                            <div class="ai-icon">ğŸ’¡</div>
                            <div class="ai-text">
                                <strong>Strategische KI-Analyse:</strong> Nutzt Marktdaten von mehreren Premium-Quellen fÃ¼r erweiterte Trading-Strategien und Risikobewertung.
                            </div>
                        </div>
                        <div id="ideas-container">
                            <div class="loading">
                                <div class="spinner"></div>
                                <span>Generiere erweiterte Trading-Ideen...</span>
                            </div>
                        </div>
                    </div>
                    <div class="disclaimer-card">
                        <div class="disclaimer-header">
                            <span class="warning-icon">âš ï¸</span>
                            <strong>Enhanced Haftungsausschluss</strong>
                        </div>
                        <p>
                            Alle Trading-Ideen und KI-Analysen basieren auf mehreren Datenquellen und dienen nur zu Informationszwecken. 
                            Bei API-Limits werden realistische Simulationen verwendet. Dies stellt keine Anlageberatung dar. 
                            Investitionen bergen Risiken und kÃ¶nnen zu Verlusten fÃ¼hren. Bitte konsultieren Sie einen qualifizierten 
                            Finanzberater und fÃ¼hren Sie eigene Recherchen durch.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <span class="footer-logo">ğŸ’°</span>
                    <span>MoneyMagnet v2.0</span>
                </div>
                <div class="footer-text">
                    Enhanced APIs â€¢ Smart Fallbacks â€¢ Real-time Intelligence â€¢ Built with â¤ï¸
                </div>
                <div class="footer-links">
                    <a href="#" class="footer-link">API Status</a>
                    <a href="#" class="footer-link">Datenschutz</a>
                    <a href="#" class="footer-link">Enhanced Features</a>
                    <a href="#" class="footer-link">Fallback System</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts in optimaler Reihenfolge -->
    <script src="data/config.js"></script>
    <script src="data/symbols.js"></script>
    <script src="js/fallback-data.js"></script>
    <script src="js/api.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>

    <script>
        // Enhanced initialization with fallback support
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                console.log('ğŸš€ Starting MoneyMagnet v2.0 Enhanced...');
                
                // Initialize with better error handling
                if (typeof app !== 'undefined') {
                    await app.init();
                    
                    // Update status indicators
                    updateStatusIndicators();
                    
                    // Set up periodic status updates
                    setInterval(updateStatusIndicators, 30000); // Every 30 seconds
                    
                } else {
                    console.error('âŒ App object not available');
                    throw new Error('App initialization failed');
                }
                
            } catch (error) {
                console.error('âŒ Critical initialization error:', error);
                
                // Show user-friendly error message
                document.body.innerHTML = `
                    <div style="
                        display: flex; 
                        align-items: center; 
                        justify-content: center; 
                        min-height: 100vh; 
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        font-family: Inter, sans-serif;
                        text-align: center;
                        padding: 2rem;
                    ">
                        <div style="
                            background: rgba(255,255,255,0.1);
                            backdrop-filter: blur(20px);
                            border-radius: 20px;
                            padding: 3rem;
                            max-width: 500px;
                        ">
                            <h1 style="font-size: 3rem; margin-bottom: 1rem;">âš ï¸</h1>
                            <h2 style="margin-bottom: 1rem;">Initialisierungsfehler</h2>
                            <p style="margin-bottom: 2rem;">
                                MoneyMagnet konnte nicht gestartet werden. 
                                Bitte laden Sie die Seite neu oder Ã¼berprÃ¼fen Sie Ihre Internetverbindung.
                            </p>
                            <button onclick="location.reload()" style="
                                background: linear-gradient(135deg, #4f46e5, #7c3aed);
                                color: white;
                                border: none;
                                padding: 1rem 2rem;
                                border-radius: 10px;
                                cursor: pointer;
                                font-weight: 600;
                            ">
                                ğŸ”„ Seite neu laden
                            </button>
                        </div>
                    </div>
                `;
            }
        });

        // Update status indicators in real-time
        function updateStatusIndicators() {
            try {
                if (typeof app === 'undefined' || !app.initialized) return;
                
                const status = app.getStatus();
                
                // Update API count
                const apiCountEl = document.getElementById('apiCount');
                if (apiCountEl) {
                    apiCountEl.textContent = status.enhancedAPIs.configured;
                }
                
                // Update fallback status
                const fallbackStatusEl = document.getElementById('fallbackStatus');
                if (fallbackStatusEl && status.fallback) {
                    fallbackStatusEl.textContent = status.fallback.fallbackActive ? 'Aktiv' : 'Bereit';
                    fallbackStatusEl.style.color = status.fallback.fallbackActive ? '#f59e0b' : '#10b981';
                }
                
                // Update source badges based on current data sources
                updateSourceBadges(status);
                
            } catch (error) {
                console.warn('Status update failed:', error.message);
            }
        }

        // Update source badges to show which APIs are being used
        function updateSourceBadges(status) {
            const badges = {
                newsSource: document.getElementById('newsSource'),
                winnersSource: document.getElementById('winnersSource'),
                losersSource: document.getElementById('losersSource'),
                cryptoNewsSource: document.getElementById('cryptoNewsSource'),
                ideasSource: document.getElementById('ideasSource')
            };
            
            // Update based on available quotas and fallback status
            Object.entries(badges).forEach(([key, element]) => {
                if (!element) return;
                
                if (status.fallback.fallbackActive) {
                    element.textContent = 'Simulation';
                    element.style.background = 'linear-gradient(135deg, #f59e0b, #d97706)';
                } else if (status.availableQuotas.yahoo > 0 || status.availableQuotas.news > 0) {
                    element.textContent = 'Premium APIs';
                    element.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                } else {
                    element.textContent = 'Cache/Fallback';
                    element.style.background = 'linear-gradient(135deg, #6b7280, #4b5563)';
                }
            });
        }

        // Enhanced global error handling
        window.addEventListener('error', (event) => {
            console.error('ğŸ’¥ Global error:', event.error);
            
            // Try to recover gracefully
            if (event.error.message.includes('API') || event.error.message.includes('fetch')) {
                console.log('ğŸ”„ API error detected - attempting fallback recovery');
                
                // Show user that we're switching to fallback
                if (typeof UIManager !== 'undefined') {
                    UIManager.showToast('API-Fehler - Wechsel zu Fallback-System', 'warning');
                }
                
                // Force fallback mode
                if (window.FallbackDataManager) {
                    console.log('ğŸ”„ Forcing fallback mode due to errors');
                }
            }
        });

        // Performance monitoring
        window.addEventListener('load', () => {
            setTimeout(() => {
                if (typeof performance !== 'undefined') {
                    const perfData = performance.getEntriesByType('navigation')[0];
                    if (perfData) {
                        const loadTime = perfData.loadEventEnd - perfData.loadEventStart;
                        console.log(`âš¡ Enhanced MoneyMagnet loaded in ${loadTime.toFixed(0)}ms`);
                        
                        // Show load time if over 5 seconds
                        if (loadTime > 5000 && typeof UIManager !== 'undefined') {
                            UIManager.showToast(`App geladen in ${(loadTime/1000).toFixed(1)}s`, 'info');
                        }
                    }
                }
            }, 1000);
        });

        // Enhanced keyboard shortcuts
        document.addEventListener('keydown', (event) => {
            // Ctrl+R or F5 - Refresh data
            if ((event.ctrlKey && event.key === 'r') || event.key === 'F5') {
                event.preventDefault();
                if (typeof app !== 'undefined' && app.refreshData) {
                    app.refreshData();
                    if (typeof UIManager !== 'undefined') {
                        UIManager.showToast('Daten werden aktualisiert...', 'info');
                    }
                }
            }
            
            // Ctrl+Shift+S - Show API status
            if (event.ctrlKey && event.shiftKey && event.key === 'S') {
                event.preventDefault();
                if (typeof app !== 'undefined' && app.showAPIStatus) {
                    app.showAPIStatus();
                }
            }
            
            // Ctrl+Shift+F - Force fallback mode (for testing)
            if (event.ctrlKey && event.shiftKey && event.key === 'F') {
                event.preventDefault();
                if (window.FallbackDataManager) {
                    console.log('ğŸ”„ Forcing fallback mode via keyboard shortcut');
                    // Temporarily disable API checks
                    Object.keys(CONFIG.RATE_LIMITS).forEach(api => {
                        CONFIG.RATE_LIMITS[api].requests = 999;
                    });
                    if (typeof UIManager !== 'undefined') {
                        UIManager.showToast('Fallback-Modus fÃ¼r Tests aktiviert', 'warning');
                    }
                }
            }
        });

        // Network status monitoring
        window.addEventListener('online', () => {
            console.log('ğŸŒ Network restored - resuming API calls');
            if (typeof UIManager !== 'undefined') {
                UIManager.showToast('Internetverbindung wiederhergestellt', 'success');
            }
        });

        window.addEventListener('offline', () => {
            console.log('ğŸš« Network lost - switching to cache/fallback mode');
            if (typeof UIManager !== 'undefined') {
                UIManager.showToast('Offline-Modus - Cache und Fallback aktiv', 'warning');
            }
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (typeof app !== 'undefined' && app.cleanup) {
                app.cleanup();
            }
        });

        // Development helpers (only in console)
        if (typeof console !== 'undefined') {
            console.log(`
ğŸš€ MoneyMagnet v2.0 Enhanced - Debug Commands:
ğŸ“Š window.MoneyMagnet.showAPIStatus() - Zeige API-Status
ğŸ”„ window.MoneyMagnet.getUsageReport() - API-Nutzungsreport  
ğŸ¥ window.MoneyMagnet.getHealthCheck() - Gesundheitscheck
ğŸ”§ window.MoneyMagnet.resetDailyLimits() - Reset fÃ¼r Tests
âŒ¨ï¸  Shortcuts: Ctrl+Shift+S (Status), Ctrl+Shift+F (Fallback), Ctrl+R (Refresh)
            `);
        }
    </script>
</body>
</html>